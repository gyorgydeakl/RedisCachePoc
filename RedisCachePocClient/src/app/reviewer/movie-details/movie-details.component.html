<section class="p-4 lg:p-8 max-w-350 mx-auto">
  <!-- ⏪ Back‑to‑list -->
  <button
    pButton
    type="button"
    class="mb-6 p-button-sm"
    routerLink="reviewer/movies"
  >
    <i class="pi pi-arrow-left" pButtonIcon></i>
    <span pButtonLabel>Back</span>
  </button>

  <!-- ░░░  LOADING / ERROR  ░░░ -->
  @if (movie.isLoading()) {
    <div class="flex items-center">
      <p-progressSpinner></p-progressSpinner>
    </div>
  } @else if (!movie.hasValue()) {
    <p class="text-center text-gray-500">Movie was not found.</p>
  }
  @else {
    @let m = movie.value();

    <!-- ░░░  MOVIE HEADER  ░░░ -->
    <h1 class="text-4xl font-semibold leading-tight mb-2">{{ m.title }}</h1>

    <div class="flex flex-wrap gap-2 mb-6">
      <p-tag [value]="m.genre" severity="info" rounded></p-tag>
      <p-tag [value]="m.director" severity="success" rounded></p-tag>
    </div>

    <!-- ░░░  PLOT  ░░░ -->
    <p-card class="mb-8 rounded-full shadow-md">
      <ng-template pTemplate="header">
        <h2 class="text-2xl font-medium pl-5 pt-5">Plot</h2>
      </ng-template>
      <p-scroll-panel class="max-h-100">
        <p class="leading-relaxed text-gray-800 whitespace-pre-line">
          {{ m.plot }}
        </p>
      </p-scroll-panel>

    </p-card>

    <!-- ░░░  REVIEWS  ░░░ -->
    <p-card class="rounded-full shadow-md p-5">
      <ng-template pTemplate="header">
        <h2 class="text-2xl font-medium flex items-center gap-2 pl-5 pt-5">
          <i class="pi pi-comments text-primary-500"></i> Reviews

          <!-- spacer pushes buttons to the right -->
          <span class="flex-grow"></span>

          <button
            pButton
            text
            type="button"
            class="p-button-sm ml-2"
            (click)="movie.reload()"
          >
            <i class="pi pi-refresh" pButtonIcon></i>
          </button>

          <button
            pButton
            text
            type="button"
            class="p-button-sm"
            (click)="generateReviews()"
          >
            <i class="pi pi-plus" pButtonIcon></i>
          </button>
        </h2>
      </ng-template>

      @if (m.reviews?.length) {
        <p-scroll-panel class="max-h-100">
          <div class="space-y-6">
            @for (rev of m.reviews; track rev.id) {
              <article class="border-l-4 border-primary-500 pl-4 space-y-1">
                <div class="flex items-center gap-3">
                  <a
                    [routerLink]="['/planner/users', rev.userId]"
                    class="font-semibold text-lg hover:underline focus:outline-none"
                  >
                    {{ rev.userName }}
                  </a>
                  <p-rating
                    [ngModel]="rev.rating"
                    [readonly]="true"
                    pStyleClass="text-base align-middle"
                  ></p-rating>
                </div>

                <h4 class="text-base font-medium">{{ rev.title }}</h4>
                <p class="opacity-80 whitespace-pre-line">{{ rev.description }}</p>
                <small class="text-sm text-gray-500">{{ rev.date | date:'mediumDate' }}</small>
              </article>
            }
          </div>
        </p-scroll-panel>

      } @else {
        <p class="italic text-gray-500">No reviews yet.</p>
      }
      <app-add-review
        class="block mt-8"
        [movieId]="m.id"
        (reviewAdded)="addReview($event)"
      ></app-add-review>
    </p-card>
  }
</section>
